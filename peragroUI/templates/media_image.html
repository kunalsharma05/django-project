{% load staticfiles %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title></title>

    <!-- Bootstrap -->
     <link href="{% static 'peragroUI/css/vendors/bootstrap/dist/css/bootstrap.min.css' %}" type="text/css" rel="stylesheet" />
    <!-- Font Awesome -->
    <link href="{% static 'peragroUI/css/vendors/font-awesome/css/font-awesome.min.css' %}" type="text/css" rel="stylesheet" />

    <!-- <link href="../vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet"> -->
    <!-- Animate.css -->
    
    <link href="https://colorlib.com/polygon/gentelella/css/animate.min.css" rel="stylesheet">


    <link href="{% static 'peragroUI/css/custom.css' %}" rel="stylesheet" type="text/css" />
<!--     <link href="{% static 'peragroUI/css/peargro.css' %}" rel="stylesheet" type="text/css" />
 -->    
    <!-- jQuery -->
   <script src="{% static 'peragroUI/css/vendors/jquery/dist/jquery.min.js' %}"></script>
    <!-- Bootstrap -->
    <script src="{% static 'peragroUI/css/vendors/bootstrap/dist/js/bootstrap.min.js' %}"></script>
    <!-- FastClick -->
    <script src="{% static 'peragroUI/css/vendors/fastclick/lib/fastclick.js' %}"></script>
    <!-- NProgress -->
    <script src="{% static 'peragroUI/css/vendors/nprogress/nprogress.js' %}"></script>
    <!-- morris.js -->
    <script src="{% static 'peragroUI/css/vendors/raphael/raphael.min.js' %}"></script>
    <script src="{% static 'peragroUI/css/vendors/morris.js/morris.min.js' %}"></script>
    <!-- bootstrap-progressbar -->
    <script src="{% static 'peragroUI/css/vendors/bootstrap-progressbar/bootstrap-progressbar.min.js' %}"></script>
    <!-- bootstrap-daterangepicker -->
    <script src="{% static 'peragroUI/js/moment/moment.min.js' %}"></script>
    <script src="{% static 'peragroUI/js/datepicker/daterangepicker.js' %}"></script>

<!--     FabricJS
 -->    <script src="{% static 'peragroUI/build/js/fabric.min.js' %}"></script>
    
    <!-- Custom Theme Scripts -->
    <script src="{% static 'peragroUI/build/js/custom.min.js' %}"></script>
        <script src="{% static 'peragroUI/build/js/annotation.js' %}"></script>
  </head>
<!--  -->
 <body class="nav-md">
    <div class="container body">
      <div class="main_container">
        <div class="row" stlye="background:738B8C">
        <div class="col-md-9">
         <div class="clearfix"></div>
         <div class="x_panel">         
                 <div class="x_title">
        <h2 id='media-name'>{{media_ob.media.name}}</h2>
                <div class="clearfix"></div>
                 </div>
                  <div class="x_content" style="text-align: center;">
                  <button id="annotate" data-toggle="modal" data-target="#annotation_modal" href="" class="btn btn-success" ><i class="fa fa-edit m-right-xs"></i>Annotate</button>
                      
<!--                       <button id="clear-canvas" class="btn btn-info">Clear Canvas</button><br>
        <button id="get-json" class="btn btn-info">Get JSON</button><br>
         <label for="drawing-color">Line color:</label>
            <input type="color" value="#f55f55" id="color-select">
          <label for="drawing-line-width">Line width:</label>
           <p id="width">5</p> <input type="range" value="5" min="0" max="150" id="width-select"><br>
 -->
        
<!--         {% for x in file_descr.assets %}
        Dependencies: {{x.dependencies}}
        {% endfor %}
 -->        
            <button id = 'test'>test</button>
        <div class="jumbotron" id="image-view" style=" position: relative; -moz-user-select: none; background: none; text-align: center; align-self: center; margin:0px auto;"> <!-- <canvas class="lower-canvas" id="c"  style="border: 1px solid rgb(170, 170, 170); position: relative; left: 0px; top: 0px; -moz-user-select: none;"></canvas> --></div>

        <!-- <h3>This element shows the JSON output, to see deserialization, clear the canvas and press deserialize</h3> -->
        <!-- 
        <button id="clear-json" class="btn btn-info">Clear JSON output</button><br>
        <button id="deserialize-json" class="btn btn-info">Deserialize JSON output</button><br>
        <button id="insert-text" class="btn btn-info">Insert Text: OFF</button><br> -->
        <div class="accordion" id="accordion" role="tablist" aria-multiselectable="true">
                      <div class="panel">
                        <a class="panel-heading collapsed" role="tab" id="headingOne" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                          <h4 class="panel-title">View Media Data</h4>
                        </a>
                        <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne" aria-expanded="false">
                          <div class="x_panel" style="text-align: left;">         
                            <div class="x_title" id="data_title" >

                            <div class="clearfix"></div>
                            </div>
                            <div class="x_content" id="data_body">
                        
              
                          </div>
                          </div>
                        </div>
                      </div>
                <!--       <div class="panel">
                        <a class="panel-heading collapsed" role="tab" id="headingTwo" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                          <h4 class="panel-title">Collapsible Group Items #2</h4>
                        </a>
                        <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo" aria-expanded="false" style="height: 0px;">
                          <div class="panel-body">
                            <p><strong>Collapsible Item 2 data</strong>
                            </p>
                            Anim pariatur cliche reprehenderit, enim eiusmod high life accusamus terry richardson ad squid. 3 wolf moon officia aute, non cupidatat skateboard dolor brunch. Food truck quinoa nesciunt laborum eiusmod. Brunch 3 wolf moon tempor,
                          </div>
                        </div>
                      </div> -->
        </div>
            
                   </div>
                </div>
              </div>
            

          <div class="col-md-3">
            <div class="x_panel">
              <!-- /menu profile quick info -->
              <div class="tab-pane fade active in" id="tab_content1" aria-labelledby="home-tab">

                            <!-- start recent activity -->
                            <ul class="messages">
                              {% for x in comments %}
                              <li>
                                <img src="{{x.author.profile.profile_pic.url}}" class="avatar" alt="Avatar">
                                <div class="message_date">
                                  <h4 class="date text-info"></h4>
                                  <p class="month"></p>
                                </div>
                                <div class="message_wrapper">
                                  <h4 class="heading">{{x.author.username}}</h4>
                                  <blockquote class="message" style="font-size: 12px;"><p>{{x.comment}}</p></blockquote>
                                  <br />
<!--                                   <button id = "{{x.id}}{{x.author}}" style="display:none;" class="xyz"></button>
 -->                                  {% if x.annotation %}
                                  <p class="url">
                                    <canvas class="lower-canvas" id="{{x.id}}" anno="{{x.annotation}}" style="border: 1px solid rgb(170, 170, 170); position: relative; left: 0px; top: 0px; -moz-user-select: none;"></canvas>
                                     <!-- <canvas id="c1{{x.id}}" style="border:1px solid black;" ></canvas> -->
                                    </br>
					<!-- <canvas id="my_canvas_id"></canvas>  -->
                                    <!-- <a href="#"><i class="fa fa-paperclip"></i> User Acceptance Test.doc </a> -->
                                  </p>
                                  {% endif %}
                                </div>
                             
                              </li>
                                
                                 {% endfor %}                             
                              <li>
                                <img src="{{user.profile.profile_pic.url}}" class="avatar" alt="Avatar">
                              <div class="message_date">
                                  <h4 class="heading"></h4>
                                  <p id="com_date" class="month"></p>
                                </div>
                              <div class="message_wrapper">
                                  <h4 class="heading">{{user.username}}</h4>
                                  <form id="only-text" action="." method="POST">
                                  <textarea style="width: 100%" name="comm-text" form="only-text"></textarea>
                                  <input type="submit" value="Comment" />
                                  </form>
                              </li>
                            </ul>
                            <!-- end recent activity -->

                          </div> 
              </div>

              <!-- sidebar menu -->
                        </div>
          </div>
    </div>
    </div>
        <!-- top navigation -->
        <!-- <div class="top_nav">
          <div class="nav_menu">
            <nav class="" role="navigation">
              <div class="nav toggle">
                <a id="menu_toggle"><i class="fa fa-bars"></i></a>
              </div>

              <ul class="nav navbar-nav navbar-right">
                <li class="">
                  <a href="javascript:;" class="user-profile dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                    <img src="images/img.jpg" alt="">{{user.first_name}} {{user.last_name}}
                    <span class=" fa fa-angle-down"></span>
                  </a>
                  <ul class="dropdown-menu dropdown-usermenu pull-right">
                    <li><a href="javascript:;"> Profile</a></li>
                    <li>
                      <a href="javascript:;">
                        <span class="badge bg-red pull-right">50%</span>
                        <span>Settings</span>
                      </a>
                    </li>
                    <li><a href="javascript:;">Help</a></li>
                    <li><a href="login.html"><i class="fa fa-sign-out pull-right"></i> Log Out</a></li>
                  </ul>
                </li>
 -->
                <!--  FOR THE NOTIFICATIONS MODULE
                <li role="presentation" class="dropdown">
                  <a href="javascript:;" class="dropdown-toggle info-number" data-toggle="dropdown" aria-expanded="false">
                    <i class="fa fa-envelope-o"></i>
                    <span class="badge bg-green">6</span>
                  </a>
                  <ul id="menu1" class="dropdown-menu list-unstyled msg_list" role="menu">
                    <li>
                      <a>
                        <span class="image"><img src="images/img.jpg" alt="Profile Image" /></span>
                        <span>
                          <span>John Smith</span>
                          <span class="time"></span>
                        </span>
                        <span class="message">
                          
                        </span>
                      </a>
                    </li> -->
                    <!-- <li>
                      <div class="text-center">
                        <a>
                          <strong>See All Alerts</strong>
                          <i class="fa fa-angle-right"></i>
                        </a>
                      </div>
                    </li> -->
                  <!-- </ul> -->
                <!-- </li> -->
<!--               </ul>
            </nav>
          </div>
        </div>
 -->        <!-- /top navigation -->

        <!-- page content -->
        
        <!-- /page content -->
<div id="annotation_modal" class="modal fade" role="dialog"> 
  <div class="modal-dialog modal-lg" id="style-modal">
        <div class="right_col" role="main">
          <div class="">
           <div class="x_panel"  style="padding:6px;">
                  <div class="x_title">
                    <h2>Annotation Panel</h2>
                    <div class="clearfix"></div>
                  </div>
                    <div class="x_content">

                    <!-- start form for validation -->
                    <table>

                    <tr><td><button id="clear-canvas" class="btn btn-info">Clear Canvas</button></td>
                    <td><button id="insert-text" class="btn btn-info">Insert Text</button></td>
        <!-- <button id="get-json" class="btn btn-info">Get JSON</button><br> -->
         <td><label for="drawing-color">Line color:</label>
            <input type="color" value="#f55f55" id="color-select"></td>
            </tr>
            <tr>
          <td><label for="drawing-line-width">Line width:</label>
           <p id="width">5</p> <input type="range" value="5" min="0" max="150" id="width-select">
</td>
</tr></table>
        <h2>Canvas for Annotations</h2>

            
        <!-- <div class="jumbotron" style="width: 100%; height: 100%; position: relative; -moz-user-select: none; background: none; text-align: center; align-self: center; margin:0px auto;"> --><canvas class="lower-canvas" id="d"  style="border: 1px solid rgb(170, 170, 170); position: relative; left: 0px; top: 0px; -moz-user-select: none;"></canvas><!-- </div> -->

        <!-- <h3>This element shows the JSON output, to see deserialization, clear the canvas and press deserialize</h3> -->
        </br>
        </br>
        <form id="commForm" action="." method="POST">
    <img src="{{user.profile.profile_pic.url}}" class="avatar" alt="Avatar">
                              <!-- <div class="message_date"> -->
                                  <h4 class="heading">{{user.username}}</h4>
           <textarea style="width: 100%" form="commForm" name="comm-text"></textarea>

        <input type="hidden" id="inp-data" name="json-data" />
        </form>
        <button id="comment" class="btn btn-info">Comment</button><br>
                  </div>
                </div>
      </div>
    </div>
    </div>

</div>
        <!-- footer content -->
        <footer style="margin-left:0px">
          <div class="pull-right pull-bottom">
            Digital Assets Managed Neatly
          </div>
          <div class="clearfix"></div>
        </footer>
        <!-- /footer content -->
      </div>
    </div>



    
<script>

  function load_comments(){
     {% for x in comments %}
        (function(){
          var cv_anno = $('#{{x.id}}');
          var anno = String(cv_anno.attr('anno'));
                      // var canvas = new fabric.Canvas('{{x.id}}');
                    // canvas.loadFromJSON(anno, canvas.renderAll.bind(canvas));
           var videoObj = JSON.parse(anno);
            var width = videoObj['objects'][0]['width'];
            var height = videoObj['objects'][0]['height'];         
  
            var a = document.getElementById('d');
            // var old_width = width;
            console.log(width)
            // var old_height = height;
            if(width>300){
              var scale = 300.00/width;
              final_width = width * scale;
              final_height = height * scale; 
            }
            else{
              final_width = width;
              final_height = height;

            }
                                    
                                     // canvas.setWidth(old_width);
                                     // canvas.setHeight(old_height);

                      // var scale = 0.5;
            var canvas1 = new fabric.Canvas('{{x.id}}');
            canvas1.setDimensions({
                "width": final_width,
                "height": final_height,
            })
                      // var json = localStorage.getItem('save');
            canvas1.loadFromJSON(anno, function () {
                canvas1.renderAll();
            });
          canvas1.setZoom(scale);
          canvas1.renderAll();
        })();
                    
     {% endfor %}
          (function(){
          $.ajax({
              dataType: 'json',
              method: 'GET',
              url: '../../media_description/{{media_ob.id}}',
         
              success : function(data) {
                console.log(data);
                var div1 = document.getElementById('data_title');
                var div2 = document.getElementById('data_body');

                var p1 = document.createElement("p");
                p1.innerHTML = '<strong>Hash:</strong> ' + data.hash + '</br><strong>Assets: </strong>'+data.assets.length+'</hr></br>';
                div1.appendChild(p1);
                for(var i = 0; i < data.assets.length; i++) {
                  var p2 = document.createElement("p");
                  p2.innerHTML = '<h5>*'+data.assets[i].subname+' '+data.assets[i].mimetype+'</h5></br>';
                  if(data.assets[i].dependencies.length != 0){
                    p2.appendChild(document.createElement("h5")).innerHTML='&nbspDependencies('+data.assets[i].dependencies.length+'):</br>';
                    }
                    for(var j = 0; j < data.assets[i].dependencies.length; j++) {
                      var p3 = document.createElement("p");
                      p3.innerHTML = '&nbsp&nbsp&nbsp&nbsp*'+data.assets[i].dependencies[j].subname+' '+data.assets[i].dependencies[j].mimetype+'</br>'
                      p2.appendChild(p3);
                    }
                  if(data.assets[i].metadata.length != 0){
                    p2.appendChild(document.createElement("h5")).innerHTML='&nbspMetadata('+data.assets[i].metadata.length+'): </br>';
                  }
                    for(var k = 0; k < data.assets[i].metadata.length; k++) {
                      var p4 = document.createElement("p");
                      p4.innerHTML = '&nbsp&nbsp&nbsp&nbsp*'+data.assets[i].metadata[k].key+': '+data.assets[i].metadata[k].val+' ('+data.assets[i].metadata[k].type+') </br>'
                      p2.appendChild(p4);
                    }
                    div2.appendChild(p2);
                  }
                }
              });
           })(); //This function is being called to return the metadata of the media object. A simple Ajax call to the server returns json data 
             
                                }
                    
  window.onload = load_comments;
  </script> 
                                
  </body>
</html>
